"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.COMMAND_WHITELIST = void 0;
exports.isCommandAllowed = isCommandAllowed;
exports.getCommandDefinition = getCommandDefinition;
exports.validateArgument = validateArgument;
exports.COMMAND_WHITELIST = {
    useradd: {
        command: 'useradd',
        description: 'Create a new Linux user',
        requiresSudo: true,
        allowedArgumentPatterns: [
            /^-m$/,
            /^-d$/,
            /^-s$/,
            /^-g$/,
            /^-G$/,
            /^--home-dir$/,
            /^--shell$/,
            /^\/home\/[a-z][a-z0-9_-]{0,31}$/,
            /^\/bin\/(bash|sh|false|nologin)$/,
            /^\/usr\/sbin\/nologin$/,
            /^[a-z][a-z0-9_-]{0,31}$/,
        ],
    },
    userdel: {
        command: 'userdel',
        description: 'Delete a Linux user',
        requiresSudo: true,
        allowedArgumentPatterns: [
            /^-r$/,
            /^-f$/,
            /^[a-z][a-z0-9_-]{0,31}$/,
        ],
    },
    usermod: {
        command: 'usermod',
        description: 'Modify a Linux user',
        requiresSudo: true,
        allowedArgumentPatterns: [
            /^-a$/,
            /^-G$/,
            /^-s$/,
            /^-L$/,
            /^-U$/,
            /^[a-z][a-z0-9_-]{0,31}$/,
            /^\/bin\/(bash|sh|false|nologin)$/,
            /^\/usr\/sbin\/nologin$/,
        ],
    },
    chpasswd: {
        command: 'chpasswd',
        description: 'Update user password',
        requiresSudo: true,
        allowedArgumentPatterns: [],
    },
    a2ensite: {
        command: 'a2ensite',
        description: 'Enable Apache site',
        requiresSudo: true,
        allowedArgumentPatterns: [/^[a-z0-9][a-z0-9.-]{0,253}\.conf$/],
    },
    a2dissite: {
        command: 'a2dissite',
        description: 'Disable Apache site',
        requiresSudo: true,
        allowedArgumentPatterns: [/^[a-z0-9][a-z0-9.-]{0,253}\.conf$/],
    },
    a2enmod: {
        command: 'a2enmod',
        description: 'Enable Apache module',
        requiresSudo: true,
        allowedArgumentPatterns: [/^[a-z][a-z0-9_-]{0,63}$/],
    },
    a2dismod: {
        command: 'a2dismod',
        description: 'Disable Apache module',
        requiresSudo: true,
        allowedArgumentPatterns: [/^[a-z][a-z0-9_-]{0,63}$/],
    },
    apachectl: {
        command: 'apachectl',
        description: 'Apache control',
        requiresSudo: true,
        allowedArgumentPatterns: [
            /^configtest$/,
            /^graceful$/,
            /^restart$/,
            /^start$/,
            /^stop$/,
        ],
    },
    systemctl: {
        command: 'systemctl',
        description: 'Control system services',
        requiresSudo: true,
        allowedArgumentPatterns: [
            /^start$/,
            /^stop$/,
            /^restart$/,
            /^reload$/,
            /^enable$/,
            /^disable$/,
            /^status$/,
            /^is-active$/,
            /^is-enabled$/,
            /^apache2$/,
            /^httpd$/,
            /^nginx$/,
            /^php[0-9.]+-fpm$/,
            /^mariadb$/,
            /^mysql$/,
            /^redis$/,
            /^redis-server$/,
            /^postfix$/,
            /^dovecot$/,
            /^named$/,
            /^bind9$/,
            /^csf$/,
            /^lfd$/,
            /^sshd$/,
        ],
    },
    chown: {
        command: 'chown',
        description: 'Change file ownership',
        requiresSudo: true,
        allowedArgumentPatterns: [
            /^-R$/,
            /^[a-z][a-z0-9_-]{0,31}:[a-z][a-z0-9_-]{0,31}$/,
            /^[a-z][a-z0-9_-]{0,31}$/,
            /^\/home\/[a-z][a-z0-9_-]{0,31}(\/[a-zA-Z0-9._-]+)*$/,
        ],
    },
    chmod: {
        command: 'chmod',
        description: 'Change file permissions',
        requiresSudo: true,
        allowedArgumentPatterns: [
            /^-R$/,
            /^[0-7]{3,4}$/,
            /^\/home\/[a-z][a-z0-9_-]{0,31}(\/[a-zA-Z0-9._-]+)*$/,
        ],
    },
    mkdir: {
        command: 'mkdir',
        description: 'Create directory',
        requiresSudo: true,
        allowedArgumentPatterns: [
            /^-p$/,
            /^-m$/,
            /^[0-7]{3,4}$/,
            /^\/home\/[a-z][a-z0-9_-]{0,31}(\/[a-zA-Z0-9._-]+)*$/,
            /^\/etc\/(apache2|httpd)\/sites-available\/[a-z0-9][a-z0-9.-]{0,253}\.conf$/,
            /^\/var\/log\/[a-z][a-z0-9_-]{0,31}$/,
        ],
    },
    rm: {
        command: 'rm',
        description: 'Remove file or directory',
        requiresSudo: true,
        allowedArgumentPatterns: [
            /^-r$/,
            /^-f$/,
            /^-rf$/,
            /^\/home\/[a-z][a-z0-9_-]{0,31}(\/[a-zA-Z0-9._-]+)+$/,
            /^\/etc\/(apache2|httpd)\/sites-(available|enabled)\/[a-z0-9][a-z0-9.-]{0,253}\.conf$/,
            /^\/etc\/php\/[0-9.]+\/fpm\/pool\.d\/[a-z][a-z0-9_-]{0,31}\.conf$/,
        ],
    },
    cp: {
        command: 'cp',
        description: 'Copy file',
        requiresSudo: true,
        allowedArgumentPatterns: [
            /^-r$/,
            /^-p$/,
            /^-a$/,
            /^\/home\/[a-z][a-z0-9_-]{0,31}(\/[a-zA-Z0-9._-]+)*$/,
        ],
    },
    mv: {
        command: 'mv',
        description: 'Move file',
        requiresSudo: true,
        allowedArgumentPatterns: [
            /^\/home\/[a-z][a-z0-9_-]{0,31}(\/[a-zA-Z0-9._-]+)*$/,
        ],
    },
    mysql: {
        command: 'mysql',
        description: 'MySQL/MariaDB client',
        requiresSudo: false,
        allowedArgumentPatterns: [
            /^-u[a-z][a-z0-9_-]{0,31}$/,
            /^-u$/,
            /^-p.*$/,
            /^-e$/,
            /^-N$/,
            /^-B$/,
            /^--execute$/,
            /^[a-z][a-z0-9_-]{0,63}$/,
        ],
    },
    mysqldump: {
        command: 'mysqldump',
        description: 'MySQL/MariaDB dump',
        requiresSudo: false,
        allowedArgumentPatterns: [
            /^-u[a-z][a-z0-9_-]{0,31}$/,
            /^-u$/,
            /^-p.*$/,
            /^--single-transaction$/,
            /^--quick$/,
            /^--lock-tables$/,
            /^[a-z][a-z0-9_-]{0,63}$/,
        ],
    },
    rndc: {
        command: 'rndc',
        description: 'Bind9 control',
        requiresSudo: true,
        allowedArgumentPatterns: [
            /^reload$/,
            /^reconfig$/,
            /^flush$/,
            /^status$/,
            /^[a-z0-9][a-z0-9.-]{0,253}$/,
        ],
    },
    'named-checkzone': {
        command: 'named-checkzone',
        description: 'Check DNS zone file',
        requiresSudo: false,
        allowedArgumentPatterns: [
            /^[a-z0-9][a-z0-9.-]{0,253}$/,
            /^\/var\/named\/[a-z0-9][a-z0-9.-]{0,253}\.zone$/,
            /^\/etc\/bind\/zones\/[a-z0-9][a-z0-9.-]{0,253}\.zone$/,
        ],
    },
    'named-checkconf': {
        command: 'named-checkconf',
        description: 'Check Bind9 configuration',
        requiresSudo: false,
        allowedArgumentPatterns: [
            /^\/etc\/named\.conf$/,
            /^\/etc\/bind\/named\.conf$/,
        ],
    },
    postmap: {
        command: 'postmap',
        description: 'Postfix map utility',
        requiresSudo: true,
        allowedArgumentPatterns: [
            /^\/etc\/postfix\/[a-z][a-z0-9_-]{0,63}$/,
        ],
    },
    postfix: {
        command: 'postfix',
        description: 'Postfix control',
        requiresSudo: true,
        allowedArgumentPatterns: [
            /^reload$/,
            /^start$/,
            /^stop$/,
            /^check$/,
        ],
    },
    certbot: {
        command: 'certbot',
        description: "Let's Encrypt certificate management",
        requiresSudo: true,
        allowedArgumentPatterns: [
            /^certonly$/,
            /^renew$/,
            /^revoke$/,
            /^delete$/,
            /^--webroot$/,
            /^--standalone$/,
            /^--apache$/,
            /^--nginx$/,
            /^-w$/,
            /^--webroot-path$/,
            /^-d$/,
            /^--domain$/,
            /^--agree-tos$/,
            /^--non-interactive$/,
            /^-n$/,
            /^--email$/,
            /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,
            /^[a-z0-9][a-z0-9.-]{0,253}$/,
            /^\/home\/[a-z][a-z0-9_-]{0,31}\/public_html$/,
        ],
    },
    csf: {
        command: 'csf',
        description: 'ConfigServer Firewall',
        requiresSudo: true,
        allowedArgumentPatterns: [
            /^-r$/,
            /^-q$/,
            /^-l$/,
            /^-s$/,
            /^-f$/,
            /^-t$/,
            /^-td$/,
            /^-ta$/,
            /^-dr$/,
            /^-tr$/,
            /^-a$/,
            /^-d$/,
            /^-ar$/,
            /^--version$/,
            /^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,
            /^\d+$/,
            /^[a-zA-Z0-9 _-]{0,100}$/,
        ],
    },
    pm2: {
        command: 'pm2',
        description: 'PM2 process manager',
        requiresSudo: false,
        allowedArgumentPatterns: [
            /^start$/,
            /^stop$/,
            /^restart$/,
            /^reload$/,
            /^delete$/,
            /^list$/,
            /^jlist$/,
            /^show$/,
            /^logs$/,
            /^flush$/,
            /^save$/,
            /^startup$/,
            /^--name$/,
            /^--watch$/,
            /^--max-memory-restart$/,
            /^--env$/,
            /^--interpreter$/,
            /^--cwd$/,
            /^[a-z][a-z0-9_-]{0,63}$/,
            /^\d+$/,
            /^[0-9]+[KMG]?$/,
            /^\/home\/[a-z][a-z0-9_-]{0,31}(\/[a-zA-Z0-9._-]+)*$/,
            /^node$/,
        ],
    },
    setquota: {
        command: 'setquota',
        description: 'Set disk quota',
        requiresSudo: true,
        allowedArgumentPatterns: [
            /^-u$/,
            /^[a-z][a-z0-9_-]{0,31}$/,
            /^\d+$/,
            /^\/home$/,
            /^\/$/,
        ],
    },
    repquota: {
        command: 'repquota',
        description: 'Report disk quota',
        requiresSudo: true,
        allowedArgumentPatterns: [
            /^-a$/,
            /^-u$/,
            /^-s$/,
            /^\/home$/,
            /^\/$/,
        ],
    },
    id: {
        command: 'id',
        description: 'Check if user exists',
        requiresSudo: false,
        allowedArgumentPatterns: [
            /^[a-z][a-z0-9_-]{0,31}$/,
        ],
    },
    getent: {
        command: 'getent',
        description: 'Get entries from databases',
        requiresSudo: false,
        allowedArgumentPatterns: [
            /^passwd$/,
            /^group$/,
            /^shadow$/,
            /^[a-z][a-z0-9_-]{0,31}$/,
        ],
    },
    du: {
        command: 'du',
        description: 'Disk usage',
        requiresSudo: false,
        allowedArgumentPatterns: [
            /^-s$/,
            /^-m$/,
            /^-sm$/,
            /^-h$/,
            /^\/home\/[a-z][a-z0-9_-]{0,31}(\/[a-zA-Z0-9._-]+)*$/,
        ],
    },
    find: {
        command: 'find',
        description: 'Find files',
        requiresSudo: false,
        allowedArgumentPatterns: [
            /^\/home\/[a-z][a-z0-9_-]{0,31}(\/[a-zA-Z0-9._-]+)*$/,
            /^-type$/,
            /^[fdl]$/,
            /^-name$/,
            /^[a-zA-Z0-9*?._-]+$/,
        ],
    },
    tee: {
        command: 'tee',
        description: 'Write to file',
        requiresSudo: true,
        allowedArgumentPatterns: [
            /^-a$/,
            /^\/home\/[a-z][a-z0-9_-]{0,31}(\/[a-zA-Z0-9._-]+)+$/,
            /^\/etc\/(apache2|httpd)\/sites-available\/[a-z0-9][a-z0-9.-]{0,253}\.conf$/,
            /^\/etc\/php\/[0-9.]+\/fpm\/pool\.d\/[a-z][a-z0-9_-]{0,31}\.conf$/,
            /^\/etc\/php-fpm\.d\/[a-z][a-z0-9_-]{0,31}\.conf$/,
            /^\/etc\/bind\/zones\/[a-z0-9][a-z0-9.-]{0,253}\.zone$/,
            /^\/var\/named\/[a-z0-9][a-z0-9.-]{0,253}\.zone$/,
        ],
    },
};
function isCommandAllowed(command) {
    return command in exports.COMMAND_WHITELIST;
}
function getCommandDefinition(command) {
    return exports.COMMAND_WHITELIST[command];
}
function validateArgument(command, argument) {
    const definition = exports.COMMAND_WHITELIST[command];
    if (!definition) {
        return false;
    }
    if (!definition.allowedArgumentPatterns || definition.allowedArgumentPatterns.length === 0) {
        return true;
    }
    return definition.allowedArgumentPatterns.some((pattern) => pattern.test(argument));
}
//# sourceMappingURL=command-whitelist.js.map